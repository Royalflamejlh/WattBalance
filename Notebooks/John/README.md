# Watt Balance

From the Project Proposal

>Since 1879, the universal standard of a kilogram was derived from a physical mass made of a platinum-iridium alloy stored away in a vault.  However, even with careful preservation in optimal conditions, over time the mass of the object drifted slightly, which is problematic for use as a constant standard.  In 2019, as part of a sweeping change to the SI system, the kilogram was redefined to depend on Planckâ€™s constant rather than the mass of a physical object.  Researchers at the National Institute of Standards and Technology (NIST) developed a device called a Watt Balance (or Kibble Balance) that uses induced magnetic fields to precisely determine the mass of a given object by measuring the rotational velocity and force generated by the balance.  A group of graduate researchers in the ABE department of UIUC created a simple replica of this balance using LEGOs, but it is imprecise, often off by 20-30% or more on measurements.  This is problematic for a device whose goal is to create very precise measurements.

>Our solution for this problem involves iterating on the design created by the UIUC graduate researchers and creating a more precise and easier to use Watt Balance.  We plan to improve the sensing capabilities of the device and make mechanical improvements to help support those changes.  By replacing the 3d printed fulcrum of the balance with a smooth axle and bearing, we can not only reduce friction in the balance, but also use a more accurate sensor on the axle than the ultrasonic sensor the previous design used.  We plan to improve the sensing of the induced current in the coil using an ammeter rather than the arduino ports as it was previously measured to further increase the accuracy of the mass calculation.  We also plan to update their current MATLAB-based software implementation to a more powerful language to allow for more efficient processing of the data.

# Meeting Log

## 02/08/2024

### Understand the project and discuss project goals with the graduate researchers

During this meeting discussed the current state of the lego watt balance, and got an understand for the scope and expectations of the project.
We hope that with a custom PCB, and new sensors we can improve the accuracy to a level that the watt balance will be and acceptable scale to use.

## 02/16/24

### First Discussion with TA

During this discussion we mainly focused on our Project Proposal. We discussed places where points were lost and modification that should be made to the project proposal. The notes from the meeting include these points:

- Find a new 3rd High-level requirement that can be tested quantitatevly.
- Add metrics and error bounds to requirements.
- Redo the block diagram to be more descriptive of components.
- Add voltage regulator to diagram, we are not allowed to use 5v power supply, and need to have a somewhat more sophisticated power subsystem.
- Make lines thicker on block diagram to improve visibility.
- Start thinking about necessary components and ordering parts.
- Add references to external links and codes.
- Review similar projects safty guidelines to reconsider our own saftey guidelines.

## 02/22/24

### Second Discussion with TA

We discussed which current sensor to use and what are plans are going forward. We have a list of things we need to do going forward:

- Email grad students about power system
- Start designing PCB
- 1st Round PCB order prep
- Go to pcb way and upload check / audit by the tuesday before the order to check for errors
- Figure out the saftey portion of the design document
- Get an accurate range of masses that the balance can measure

### Finished Design Document

Finished and submitted the design document.

## 02/23/24

We updated the proposal to include:

- Better tolerance analysis
- References and citations

And we rewrote the saftey section.

## 03/04/24

### Part Selection Discussion

Discussion of which parts to get

Possible parts

- M9105-K12 (Position sensing)
- ERCK HE Sensor (Position sensing)
- ACS70331EESATR (Current Sensing)

also Justin and julian worked on figuring out how to do the cad sharing and started working on the physical modeling.

## 03/05/24

### Third Discussion with TA

Notes from the ta meeting:

- Need to get a better tolerance analysis
- Make is clearer how current is being used
- Make BLI equation and usage clear

also we got the instructions for how to use myECE

## 03/19/24

### Discussion with Team

No TA meeting, the board cad has been started, and the physcial cad model is mostly done with the prototype. Decided on ATMega chip and board parts.

## 03/24/24

Met in discord call to order parts. Ordered:

- ATMega328PB
- ERCK 05SPI 360
- USB4085
- FT232RL

and discussed the operations the pcb must perform, such as communication with a computer, driving the coils, reading the current sensor, reading the hall effect sensor and getting power.

We also have a list of things Justin is ordering for the mechanical:

- Bearing
- Coil wire
- USB cable
- shaft
- plastic
- magnets

## 03/25/24

Finished schematic and pushed the changes, julain completed the footprints and order placed.

## 03/27/24

Wrote and finished the individual progress report

## 03/31/24

Found issue in the ordering of parts, the status was not set to approved so we have to wait before we start are assembly, which we planned to do tommorow.

## 04/01/24

Setting up coding enviroment. For our chip the pb we have to use the atmel studio ide, looked into using vscode but had to custom change the include headers files to correctly compile for the pb.

## 04/09/24

Did not have TA meeting. We got our pcb delivered.

## 04/10/24

Orders have arrived and fixed issue with another order not going through, also found our pcb and screen in the room.


## 04/11/24

Soldered together PCB, we are missing crucial components so we stopped.

## 04/12/24

### New Schematic

Started redesigning the schematic with some big changes

- Way to deliver correct bipolar voltage to the atmega adc through a voltage shift
- Add a pwm controlled half bridge to send out the current
- Found a esd protection chip for the usb port
- Got new values for the oscillators
- Changes the usb chip we are using the the rtl
- set up the opamp to deliver bipolar power

## 04/13/24

### Finished schematic

Put finishing work on schematic and helped with the footprints

Also ordered all the new parts necessary for our new schematic, the op amp half bridge voltage power supply negative, and the esd protection

### Coding I

Set up and started working on the code in microchip studio
For the code I chose to write it in C

## 04/14/24

### Coding II

Adding libraries to the code that I find on github which are helpful for interfacing with the device. Spending lots of time writing the HAL layers for each chip to communicate the the mega. Right now have each mode be driven by a timer with a update callback function that does the respective stuff.

## 04/16/24

### Coding III

Finished up coding and reorganized code to make it look nice

### Mock Demo

For the mock demo we have the main part of the balance done, but nothing is operational as we dont have a pcb. Also our HE sensor might not work because the data sheet says its specified as a CW version.

## 04/18/24

### Soldering I

We started soldering the new pcb order, also got a list of all the parts not connecting.  We found that the current sensor was place in parallel not in series causing issues. Our esd chip is to small for our board. Also we were not able to find a short and ended up smoking our usb to uart chip.

## 04/20/24

### Soldering II

I went to the part shop and found a replacement usb chip, along with the missing components for our board. Also found we need to order another lm1117.

### Coding IV

Worked on testing and debugging code, tried to use a simulator but had to manually type the IO on pin, the arduino also cant take on the code.

## 04/21/24

### Soldering III

Picked up the parts from the supply center, we are having trouble now getting the atmega to program now that we have all the new parts.

We found that the ground for the chips was not connected in the footprint, and as a result we have to solder many jumper wires to many chips. Also found replacement op amp in self service. Also found the the self service had the same uart to usb chip that we are using so blowing it up wasn't a problem.

Gave up on getting atmega to work and wrote basic code on the arduino to drive the coil B so we have something to show for the demo

## 04/22/24

### Demo

The demo went well

## 04/23/24

Continued to work on seeing if the atmega could program, but it seems there is no way to communicate with the chip. We have decided to just use the arduino uno for the rest of the project.

Helped write the slides for mock presentation.

## 04/24/24

### Mock Presentation

Went, got the feedback:

- Less text on the slides
- r&v tables
- Talk like proud of project
- Hand placement (not in pocket)

## 04/25/24

Wrote code to iterate through all the possible spi values to hopefully get a reading from the hall effect sensor

## 04/26/24

Got the SPI reading from the sensor and started getting the rest of the calculations to work

Wrote a bunch of slides for the next presentation and started getting visual for it

## 04/27/24

Met today to work more on code and balance, pretty much everything is working, it just is not very accurate, as the BL is wrong.

## 04/28/24

Met today and got data from the balance by forcing it to print all the reading in each mode. Also got oscilliscope readings for the presentation and for the slides. 

## 04/29/24

Kept working on the slide show and added all the graphs and readings into the slides show and reordered the slide show to flow correctly.

## 04/30/24

### Presentation

Our presentation went well and the ABE team to watch it.

### Final Report

Started on the final report, I organized it and wrote the 1st section (introduction) today, as well as the pcb part of the design while justin wrote the mechanical portions

## 05/1/24

Finished the final report today, created the references and wrote the design verifications for the non mechanical subsystems.